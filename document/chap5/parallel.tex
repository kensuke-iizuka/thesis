\chapter{GoogLeNetの並列化検討}
{
\label{chap:parallel}

\subsection{概要}
本章ではまず、GoogLeNetの並列化検討を行う要素を明確にする。
次に並列化検討要素ごとに考察を行う。
本研究では次の3つについて並列化を検討する
\begin{itemize}
   \item Inception層 
   \item 畳み込み演算 
   \item Pooling処理 
\end{itemize}
\subsection{Inception層の並列化}
\label{sec:inception_para}
表\ref{table:}からもわかるようにGoogLeNetはサイズの違いはあるが、Inception層がその大半を占めている、
これがInception層に注目した理由である。
Inception層は図\ref{fig:}に示すように4つの計算に分割することができる。
便宜上図に示すようにthread1からthread4と名付けて議論する。
各スレッドには前層の出力値が入力値として与えられどのスレッドにも同じ入力値がブロードキャストされる。
各スレッドは最後にそれぞれの出力層を図\ref{fig:}に示すように深さ方向に結合するまでの間は互いに依存せずに
演算を行う。このことからInception層全体の並列化を考えると各スレッドごとに並列化することができる。
ここでは各スレッドのワークバランスは考えないものとする

\subsection{畳み込み演算の並列化}
\label{sec:conv_para}
\ref{sec:inception_para}章で述べたInception層の並列化にともなって各スレッドで実行される畳み込み演算の並列化を検討する。
CNNはその名の通り畳み込み演算が主演算となるのでこの並列化は様々な研究で検討される。
畳み込み演算はその演算の性質上、とくにデータ並列度が高い。
本研究ではフィルタパラメータを各FPGAボードのローカルメモリ(BRAM)に保存し、入力特徴マップとの演算を行い、出力特徴マップを
求めるという設計を行う、これはあるFPGAがネットワークの特定の層のある箇所のみの演算を行い次々とFPGAボードを伝搬させていくという設計方針を満たす
ためである。次々と入力値をFPGAが受け取りストリーム処理を行うイメージである。
肝心の並列化であるが、出力特徴マップを分割することを考える。特徴出力マップ同士には依存性がないが、次層での入力値となることを考えると、
すべての特徴出力マップが揃うのを待つ必要がある。
この並列化のイメージは図\ref{fig:}である
図中ではInception3a層のthread2の3x3畳み込み演算の入出力サイズを用いている。
入力サイズ(96,30,30) 出力サイズ(128,28,28)に対して、32並列化を実行している。
並列化された各ノードは入力サイズ(96,30,30)を受け取り出力サイズ(4,28,28)を出力する。
こうすることでシリアルに処理するときと比較して理論的には32倍の速度性能を達成することができる。
しかし演算の最後に深さ方向での結合をしなければならない。
入力値について並列化することも考えられる。
しかし、これは並列化して得られた出力特徴マップ間の対応する要素の総和を求めなければいけないので
かえって遅くなってしまう恐れがある。

\subsection{pooling処理の並列化}
\label{sec:pool_para}
Inception層でのpooling処理はフィルタサイズの領域ごとの最大値を出力特徴マップに渡す、maxpoolingが行われる
pooling処理は入力値である三次元特徴マップの深さの次元について並列化が可能である。
その様子を図\ref{fig:}に示す。

}